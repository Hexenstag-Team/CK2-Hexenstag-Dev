# Written by Flavio

namespace=HF

####################################################################
#Additional benefits from Converter's new Priest.

#Hidden ping from the priest to decide what event to send to the Converter.
character_event = {
	id = HF.20110
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		religion = FROM
		NOT = { trait = incapable }
		FROM = {
			is_alive = yes
			NOT = { trait = incapable }
		}
	}

	immediate = {
		random_list = {
			#Change to Gavelkind.
			#Improve capital's infrastructure. (province modifier)
			#Increase learning/stewardship/diplomacy.
			#Chance to gain technology.
			#Chance to gain Sponsor's culture as well.
			#Chance to gain militant monks. (event troops)

			100 = {  #Offer chance to get Gavelkind.
				trigger = {
					FROM = {
						primary_title = { has_law = succ_elective_gavelkind }
						NOT = { has_character_flag = flag_converter_chaplain_refused_gavelkind }
					}
				}
				FROM = { character_event = { id = HF.20112 } }
			}
			25 = {  #Improve capital's infrastructure. (province modifiers)
				trigger = {
					FROM = {
						capital_scope = {
							NOR = {
								has_province_modifier = mass_baptism_capital_traders
								has_province_modifier = mass_baptism_capital_missionaries
								has_province_modifier = mass_baptism_capital_builders
							}
						}
					}
				}
				FROM = { character_event = { id = HF.20113 } }
			}
			25 = {  #Increase learning/stewardship/diplomacy.
				trigger = {
					ROOT = {
						OR = {
							attribute_diff = { character = FROM attribute = diplomacy  value = 1 }
							attribute_diff = { character = FROM attribute = learning  value = 1 }
							attribute_diff = { character = FROM attribute = stewardship  value = 1 }
						}
					}
				}
				FROM = { character_event = { id = HF.20114 } }
			}
			10 = {  #Chance to gain technology.
				trigger = {
					FROM = {
						is_tribal = yes
					}
				}
				FROM = { character_event = { id = HF.20115 } }
			}
			5 = {  #Chance to change culture.
				trigger = {
					FROM = {
						NOR = {
							culture = ROOT
							has_character_flag = flag_converter_refused_chaplain_culture_conversion
						}
						culture_group = ROOT  #Needs to be compatible already.
					}
				}
				FROM = { character_event = { id = HF.20116 } }
			}
			5 = {  #Chance to gain event troops.
				trigger = {
					is_tribal = yes
					culture = FROM #Completely integrated.
					FROM = { has_any_opinion_modifier = opinion_baptism_sponsor_target } #Sponsor still lives.

				}
				FROM = { character_event = { id = HF.20117 } }
			}
			1 = {  #Skip a turn.
				FROM = { character_event = { id = HF.20111 days = 1500 random = 500 } }
			}
		}
	}
}

#Ping to Converter and back to random list.
character_event = {
	id = HF.20111
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = { character_event = { id = HF.20110 } }
	}
}

#Priest gives opportunity to change succession law to Gavelkind from Elective Gavelkind.
character_event = {
	id = HF.20112
	desc = EVTDESCAHF20112
	picture = GFX_evt_monk
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTAHF20112
		trigger = {
			primary_title = { has_law = succ_elective_gavelkind }
		}
		tiered_prestige_negative_effect = yes
		primary_title = {
			show_scope_change = no
			add_law = succ_gavelkind
		}
		hidden_tooltip = {
			any_demesne_title = {
				add_law = {
					law = succ_gavelkind
					cooldown = no
					opinion_effect = no
				}
			}
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = EVTOPTBHF20112
		set_character_flag = flag_converter_chaplain_refused_gavelkind
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1000 random = 250 } }
		}
		ai_chance = {
			factor = 0
		}
	}
}

#Priest gives opportunity to apply modifier on capital.
character_event = {
	id = HF.20113
	desc = EVTDESCAHF20113
	picture = GFX_evt_castle_construction
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTAHF20113
		trigger = {
			NOT = { capital_scope = { has_province_modifier = mass_baptism_capital_traders } }
		}
		tiered_prestige_negative_effect = yes
		capital_scope = {
			show_scope_change = no
			add_province_modifier = {
				modifier = mass_baptism_capital_traders
				years = 5
			}
		}
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}
	option = {
		name = EVTOPTBHF20113
		trigger = {
			NOT = { capital_scope = { has_province_modifier = mass_baptism_capital_missionaries } }
		}
		tiered_prestige_negative_effect = yes
		capital_scope = {
			show_scope_change = no
			add_province_modifier = {
				modifier = mass_baptism_capital_missionaries
				years = 5
			}
		}
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}
	option = {
		name = EVTOPTCHF20113
		trigger = {
			NOT = { capital_scope = { has_province_modifier = mass_baptism_capital_builders } }
		}
		tiered_prestige_negative_effect = yes
		capital_scope = {
			show_scope_change = no
			add_province_modifier = {
				modifier = mass_baptism_capital_builders
				years = 5
			}
		}
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 20
		}
	}
	option = {
		name = EVTOPTDHF20113
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1000 random = 250 } }
		}
		ai_chance = {
			factor = 10
		}
	}
}

#Priest gives opportunity to increase attribute.
character_event = {
	id = HF.20114
	desc = EVTDESCAHF20114
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTAHF20114
		trigger = {
			FROM = { attribute_diff = { character = ROOT attribute = diplomacy value = 1 } }
		}
		tiered_prestige_negative_effect = yes
		change_diplomacy = 1
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}
	option = {
		name = EVTOPTBHF20114
		trigger = {
			FROM = { attribute_diff = { character = ROOT attribute = stewardship value = 1 } }
		}
		tiered_prestige_negative_effect = yes
		change_stewardship = 1
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}
	option = {
		name = EVTOPTCHF20114
		trigger = {
			FROM = { attribute_diff = { character = ROOT attribute = learning value = 1 } }
		}
		tiered_prestige_negative_effect = yes
		change_learning = 1
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}
	option = {
		name = EVTOPTDHF20114
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1000 random = 250 } }
		}
		ai_chance = {
			factor = 0
		}
	}
}

#Gain technology.
character_event = {
	id = HF.20115
	desc = EVTDESCHFA20115
	picture = GFX_evt_castle_construction

	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTAHF20115
		tiered_prestige_negative_effect = yes
		military_techpoints = 30
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}
	option = {
		name = EVTOPTBHF20115
		tiered_prestige_negative_effect = yes
		economy_techpoints = 30
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}
	option = {
		name = EVTOPTCHF20115
		tiered_prestige_negative_effect = yes
		culture_techpoints = 30
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}

	option = {
		name = EVTOPTDHF20115
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1000 random = 250 } }
		}
		ai_chance = {
			factor = 10
		}
	}
}

#Change culture.
character_event = {
	id = HF.20116
	desc = EVTDESCHFA20116
	picture = GFX_evt_emissary

	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTAHF20116
		tiered_prestige_negative_effect = yes
		culture = FROM
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 5
				trait = trusting
			}
		}
	}

	option = {
		name = EVTOPTBHF20116
		set_character_flag = flag_converter_refused_chaplain_culture_conversion
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1000 random = 250 } }
		}
		ai_chance = {
			factor = 99
		}
	}
}

#Militant faithful arrive.
character_event = {
	id = HF.20117
	desc = EVTDESCHFA20117
	picture = GFX_evt_crusaders

	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTAHF20117
		tiered_prestige_negative_effect = yes
		capital_scope = {
			show_scope_change = no
			ROOT = {
				show_scope_change = no
				spawn_unit = {
					province = PREV
					home = PREV
					owner = THIS
					match_character = THIS
					match_mult = 0.075
					match_min = 50
					match_max = 500
					attrition = 1.0
					can_inherit = no
				}
			}
		}
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1500 random = 500 } }
		}
		ai_chance = {
			factor = 30
		}
	}

	option = {
		name = EVTOPTBHF20117
		set_character_flag = flag_converter_refused_chaplain_culture_conversion
		hidden_tooltip = {
			FROM = { character_event = { id = HF.20110 days = 1000 random = 250 } }
		}
		ai_chance = {
			factor = 10
		}
	}
}

#Court Chaplain Makes you change your name.
character_event = {
	id = HF.20118
	desc = {
		text = EVTDESCHFA20118
		trigger = {
			religion_group = old_world_group
		}
		picture = GFX_evt_icon
	}
	desc = {
		text = EVTDESCHFB20118
		trigger = {
			religion_group = ormazd_gods_group
		}
		picture = GFX_evt_imam
	}
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion

	trigger = {
		OR = {
			religion_group = old_world_group
			religion_group = ormazd_gods_group
		}
		event_target:convert_lord_spiritual = {
			is_alive = yes
			religion = ROOT
			NOT = { trait = incapable }
		}
	}
	is_triggered_only = yes

	option = {
		name = EVTOPTAHF20118
		tiered_prestige_negative_effect = yes
		tiered_piety_reward_effect = yes
		prompt_name = {
	        player = ROOT
	        type = BAPTISM
	        name_list = religion # Optional. What name list to use. Can also use "religion" for religious names of the scoped character's religion, or "culture"
		}
		hidden_tooltip = {
			any_realm_character = {
				limit = {
					is_close_relative = ROOT
					religion = ROOT
					NOT = { trait = incapable }
				}
				character_event = { id = HF.20119 }
			}
		}
		ai_chance = {
			factor = 30
		}
	}

	option = {
		name = EVTOPTBHF20118
		tiered_prestige_reward_effect = yes
		tiered_piety_negative_effect = yes
		ai_chance = {
			factor = 10
		}
	}
}
#Close relatives switch as well.
character_event = {
	id = HF.20119
	desc = EVTDESCHFA20119
	picture = GFX_evt_icon

	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTAHF20119
		tiered_prestige_negative_effect = yes
		tiered_piety_reward_effect = yes
		prompt_name = {
	        player = ROOT
	        type = BAPTISM
	        name_list = religion # Optional. What name list to use. Can also use "religion" for religious names of the scoped character's religion, or "culture"
		}
		ai_chance = {
			factor = 30
		}
	}

	option = {
		name = EVTOPTBHF20119
		tiered_piety_negative_effect = yes
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				NOT = { true_religion = FROM }
			}
		}
	}
}
