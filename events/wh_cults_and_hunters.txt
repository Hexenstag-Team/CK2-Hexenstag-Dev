namespace = wh_cults_and_hunters

### NOTES ###
#
# This is a fairly complex subsystem, so extensive comments accompany the script to guide any expansion.
# A few general pointers:
# The biggest technical issue in the design is preserving the information of which Underground Cult is acting on a particular object until the Witch Hunters can respond.
# With courtiers, this is trivially achieved by the persistent_event_target.
# However, counties are a bigger problem. Not only does persistent_event_target not work in this scope, but it wouldn't be a solution anyway because multiple cults might be acting on the county at the same time.
# The design uses two solutions. For AI actions, the information is preserved in event_target and event chains persist from the action being taken through to the end of the response. This is somewhat rigid but most of the ai behavior in this subsystem is hidden from the player.
# For player actions, dynamic flags are used that allow them to be identified from the affected county by using the dynamic flag as a limiter on random_/any_title scopes. This is a relatively expensive solution but allows the player to interact by decisions at the time and place of their choosing.

### Setup & Maintenance effects ###
#ids 0-100 reserved for setup/maintenance
#Origin event, find find cults and fire setup event sequence for them
character_event = {
    id = wh_cults_and_hunters.0
    hide_window = yes
    is_triggered_only = yes

    only_playable = yes

    trigger = {
        has_landed_title = k_cult_of_the_lady
        is_save_game = no
    }

    immediate = {
        #find & prepare Cults
        any_title = {
            limit = {
                has_title_flag = underground_cult
            }
            holder_scope = {
                add_trait = underground_cult_member
                set_character_flag = underground_cult_leader
                save_persistent_event_target = {
                    name = underground_cult_allegiance
                    scope = primary_title
                }
                if = {
                    limit = {
                        ai = yes
                    }
                    find_starting_cultic_activity_kingdom_target_effect = yes
                    save_persistent_event_target = {
                        name = cultic_activity_target
                        scope = event_target:target_kingdom
                    }
                    #AI simulates pre-game activity
                    character_event = {
                        id = wh_cults_and_hunters.1
                    }
                }
            }
        }
        #distribute false clues
        any_province = {
            limit = {
                religion_group = old_world_group
                OR = {
                    de_jure_liege_or_above = e_kislev
                    de_jure_liege_or_above = e_the_empire
                    de_jure_liege_or_above = e_bretonnia
                    de_jure_liege_or_above = e_estalia
                    de_jure_liege_or_above = e_tilea
                    de_jure_liege_or_above = e_borderlands
                }
            }
            if = {
                limit = {
                    has_wonder = yes
                }
                while = {
                    count = 2
                    random = {
                        chance = 30
                        province_event = { id = wh_cults_and_hunters.2 }
                    }
                }
            }
            else = {
                while = {
                    count = 2
                    random = {
                        chance = 15
                        province_event = { id = wh_cults_and_hunters.2 }
                    }
                }
            }
        }
    }
}

character_event = {
    id = wh_cults_and_hunters.1
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        ##determine AI's pre-game moves
        set_character_flag = making_pre_game_moves
        #1/5th of Intrigue
        export_to_variable = {
            which = pre_game_cult_moves
            value = intrigue
        }
        divide_variable = {
            which = pre_game_cult_moves
            value = 5
        }
        while = {
            limit = {
                check_variable = {
                    which = pre_game_cult_moves
                    value > 0
                }
            }
            character_event = {
                id = wh_cults_and_hunters.201
            }
            subtract_variable = {
                which = pre_game_cult_moves
                value = 1
            }
        }
        clr_character_flag = making_pre_game_moves
    }
}

province_event = {
    id = wh_cults_and_hunters.2
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        false_clues_appear_effect = yes
    }
}

#clears influencing flags after a cult moves on
province_event = {
    id = wh_cults_and_hunters.3
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        save_event_target_as = clue_county
        event_target:cult_identity = {
            clr_title_flag = cult_is_influencing_@event_target:clue_county
        }
    }
}

#maintenance event to preserve Cult mechanics through inheritance
character_event = {
    id = wh_cults_and_hunters.10
    hide_window = yes
    is_triggered_only = yes

    only_playable = yes

    trigger = {
        FROM = {
            has_title_flag = underground_cult
        }
    }

    immediate = {
        add_trait = underground_cult_member
        set_character_flag = underground_cult_leader
        save_persistent_event_target = {
            name = underground_cult_allegiance
            scope = primary_title
        }
        if = {
            limit = {
                ai = yes
            }
            find_starting_cultic_activity_kingdom_target_effect = yes
            save_persistent_event_target = {
                name = cultic_activity_target
                scope = event_target:target_kingdom
            }
        }
    }
}
### Cultic Activity ###
#ids 101-500 reserved for cultic activity

## AI Cultist Pulse (on ??? pulse)
#101

## AI Cultic Tactical Pulse (on_yearly_pulse)
character_event = {
    id = wh_cults_and_hunters.201
    hide_window = yes
    is_triggered_only = yes

    only_playable = yes
    has_character_flag = underground_cult_leader
    ai = yes

    immediate = {
        #check for defeat by Witch Hunters
        if = {
            limit = {
                check_variable = {
                    which = cultic_influence
                    value < 0
                }
            }
            #count number of defeats
            change_variable = {
                which = defeats_by_hunters
                value = 1
            }
            #The Gods' plans are disrupted
            reduce_doom_progress_medium_effect = yes
            #and the Cult must find a new target
            find_new_cultic_activity_kingdom_target_effect = yes
            save_persistent_event_target = {
                name = cultic_activity_target
                scope = event_target:target_kingdom
            }
            set_variable = {
                which = cultic_influence
                value = 10
            }
        }
        #otherwise, keep trying to capture it for Kay-os
        else = {
            #set cult leader & cult title as event targets for downstream effects
            save_event_target_as = cult_leader
            primary_title = {
                save_event_target_as = cult_identity
            }
            #remember our current target
            persistent_event_target:cultic_activity_target = {
                save_event_target_as = cultic_area_of_operations
            }
            ##determine number of actions
            #starting value set by (influence + intrigue)/5
            set_variable = {
                which = cult_tactical_actions
                value = intrigue
            }
            change_variable = {
                which = cult_tactical_actions
                which = cultic_influence
            }
            divide_variable = {
                which = cult_tactical_actions
                value = 15
            }
            #bonus moves for old vampires & those favored by chaos
            if = {
                limit = {
                    OR = {
                        trait = champion_undivided
                        trait = champion_khorne
                        trait = champion_nurgle
                        trait = champion_slaanesh
                        trait = champion_tzeentch
                        AND = {
                            is_vampire_visible = yes
                            age < 250
                        }
                    }
                }
                change_variable = {
                    which = cult_tactical_actions
                    value = 1
                }
            }
            else_if = {
                limit = {
                    OR = {
                        trait = chaos_chosen
                        trait = chosen_khorne
                        trait = chosen_nurgle
                        trait = chosen_slaanesh
                        trait = chosen_tzeentch
                        AND = {
                            is_vampire_visible = yes
                            age < 800
                        }
                    }
                }
                change_variable = {
                    which = cult_tactical_actions
                    value = 2
                }
            }
            else_if = {
                limit = {
                    OR = {
                        trait = prince_undivided
                        trait = prince_khorne
                        trait = prince_nurgle
                        trait = prince_slaanesh
                        trait = prince_tzeentch
                        is_vampire_visible = yes #note that because of previous clauses in this if/else chain, this means a very old vampire
                    }
                }
                change_variable = {
                    which = cult_tactical_actions
                    value = 3
                }
            }
            #pity actions for failing cults
            if = {
                limit = {
                    check_variable = {
                        which = cult_tactical_actions
                        value < 2
                    }
                }
                set_variable = {
                    which = cult_tactical_actions
                    value = 2
                }
            }
            #use current doom level to throttle actions
            trigger_switch = {
                on_trigger = has_global_flag
                doom_very_low = {
                    while = {
                        count = 12
                        limit = {
                            check_variable = {
                                which = cult_tactical_actions
                                value > 0
                            }
                        }
                        #determine action
                        cultic_tactical_action_effect = yes
                    }
                }
                doom_low = {
                    while = {
                        count = 15
                        limit = {
                            check_variable = {
                                which = cult_tactical_actions
                                value > 0
                            }
                        }
                        #determine action
                        cultic_tactical_action_effect = yes
                    }
                }
                doom_medium = {
                    while = {
                        count = 20
                        limit = {
                            check_variable = {
                                which = cult_tactical_actions
                                value > 0
                            }
                        }
                        #determine action
                        cultic_tactical_action_effect = yes
                    }
                }
                doom_high = {
                    while = {
                        count = 25
                        limit = {
                            check_variable = {
                                which = cult_tactical_actions
                                value > 0
                            }
                        }
                        #determine action
                        cultic_tactical_action_effect = yes
                    }
                }
                doom_very_high = {
                    while = {
                        count = 35
                        limit = {
                            check_variable = {
                                which = cult_tactical_actions
                                value > 0
                            }
                        }
                        #determine action
                        cultic_tactical_action_effect = yes
                    }
                }
            }
        }
        #Regional effects - put here to avoid regional effects breaking Cults in pre-game
        #Tilea: weak Winds
        if = {
            limit = {
                religion_group = chaos_gods_group
                persistent_event_target:cultic_activity_target = {
                    empire = {
                        title = e_tilea
                    }
                }
            }
            subtract_variable = {
                which = cultic_influence
                value = 8
            }
        }
    }
}

#invited to secret rites
character_event = {
    id = wh_cults_and_hunters.251
    desc = EVTDESC_wh_cults_and_hunters_251
    picture = GFX_evt_feast

    is_triggered_only = yes

    immediate = {
        if = {
            limit = {
                ai = yes
            }
            random_list = {
                #Didn't go
                30 = {
                    modifier = {
                        factor = 2
                        trait = shy
                    }
                    modifier = {
                        factor = 0.5
                        trait = gregarious
                    }
                    modifier = {
                        factor = 0.2
                        trait = cynical
                    }
                    modifier = {
                        factor = 5
                        trait = zealous
                    }
                    modifier = {
                        factor = 0.8
                        OR = {
                            trait = scholar
                            trait = mystic
                            trait = erudite
                        }
                    }
                    modifier = {
                        factor = 0.5
                        has_law = witch_hunter_law_0
                    }
                    modifier = {
                        factor = 4
                        has_law = witch_hunter_law_3
                    }
                    #refer to Witch Hunter, if applicable
                }
                ##Outcomes for going to the rite
                #Cultic rite: Corrupted
                20 = {
                    trigger = {
                        has_character_flag = invited_to_cultic_rite
                    }
                    corrupted_by_underground_cult_effect = yes
                }
                #Non-cultic rite: may gain or lose learning
                10 = {
                    trigger = {
                        NOT = {
                            has_character_flag = invited_to_cultic_rite
                        }
                    }
                    change_learning = 2
                }
                10 = {
                    trigger = {
                        NOT = {
                            has_character_flag = invited_to_cultic_rite
                        }
                    }
                    change_learning = -1
                }
            }
            clr_character_flag = invited_to_secret_rite
            clr_character_flag = invited_to_cultic_rite
        }
    }

    option = {
        name = OK
        trigger = { ai = no }
        #write ai = no narrative
    }

    option = {
        name = NO
        trigger = { ai = no }
        #refer to witch hunter
    }

    #fail out for AI, just in case
    option = {
        name = OK
        trigger = { ai = yes }
    }
}

#invited to secret party
character_event = {
    id = wh_cults_and_hunters.261
    desc = EVTDESC_wh_cults_and_hunters_261
    picture = GFX_evt_feast

    is_triggered_only = yes

    immediate = {
        if = {
            limit = {
                ai = yes
            }
            random_list = {
                #Didn't go
                30 = {
                    modifier = {
                        factor = 2
                        trait = shy
                    }
                    modifier = {
                        factor = 0.5
                        trait = gregarious
                    }
                    modifier = {
                        factor = 0.2
                        trait = cynical
                    }
                    modifier = {
                        factor = 5
                        trait = zealous
                    }
                    modifier = {
                        factor = 0.8
                        OR = {
                            trait = hedonist
                            trait = socializer
                            trait = seducer
                            trait = seductress
                        }
                    }
                    modifier = {
                        factor = 0.5
                        has_law = witch_hunter_law_0
                    }
                    modifier = {
                        factor = 4
                        has_law = witch_hunter_law_3
                    }
                    #refer to Witch Hunter, if applicable
                }
                ##Outcomes for going to the rite
                #Cultic party: Corrupted
                20 = {
                    trigger = {
                        has_character_flag = invited_to_cultic_party
                    }
                    corrupted_by_underground_cult_effect = yes
                }
                #Non-cultic party: may gain or lose diplomacy
                10 = {
                    trigger = {
                        NOT = {
                            has_character_flag = invited_to_cultic_party
                        }
                    }
                    change_diplomacy = 2
                }
                10 = {
                    trigger = {
                        NOT = {
                            has_character_flag = invited_to_cultic_rite
                        }
                    }
                    change_diplomacy = -1
                }
            }
            clr_character_flag = invited_to_secret_party
            clr_character_flag = invited_to_cultic_party
        }
    }

    option = {
        name = OK
        trigger = { ai = no }
        #write ai = no narrative
    }

    option = {
        name = NO
        trigger = { ai = no }
        #refer to witch hunter
    }

    #fail out for AI, just in case
    option = {
        name = OK
        trigger = { ai = yes }
    }
}

#stalked by killer
character_event = {
    id = wh_cults_and_hunters.271
    desc = EVTDESC_wh_cults_and_hunters_271
    picture = GFX_evt_whispers

    is_triggered_only = yes

    immediate = {
        if = {
            limit = {
                ai = yes
            }
            random_list = {
                #avoided contact
                30 = {
                    modifier = {
                        factor = 1.5
                        trait = craven
                    }
                    modifier = {
                        factor = 2
                        trait = paranoid
                    }
                    modifier = {
                        factor = 1.5
                        trait = shy
                    }
                    modifier = {
                        factor = 0.5
                        trait = gregarious
                    }
                    modifier = {
                        factor = 0.8
                        trait = socializer
                    }
                    modifier = {
                        factor = 0.5
                        has_law = witch_hunter_law_0
                    }
                    modifier = {
                        factor = 4
                        has_law = witch_hunter_law_3
                    }
                    #well-guarded
                    modifier = {
                        factor = 1.5
                        TIER = COUNT
                    }
                    modifier = {
                        factor = 2.5
                        tier = DUKE
                    }
                    modifier = {
                        factor = 4
                        tier = KING
                    }
                    modifier = {
                        factor = 6
                        tier = EMPEROR
                    }
                    #refer to Witch Hunter, if applicable
                }
                ##Outcomes for encountering the killer
                #Cultic killer: Ritually murdered
                20 = {
                    trigger = {
                        has_character_flag = stalked_by_cultic_killer
                    }
                    death = {
                        death_reason = death_murder_unknown_butchered
                    }
                    #notify witch hunter
                }
                #Non-cultic killer: straight up murdered
                20 = {
                    trigger = {
                        NOT = {
                            has_character_flag = stalked_by_secret_killer
                        }
                    }
                    death = {
                        death_reason = death_murder_unknown_butchered
                    }
                    #notify witch hunter
                }
                #Attacked and fled!
                10 = {
                    modifier = {
                        factor = 3
                        trait = craven
                    }
                    modifier = {
                        factor = 0.5
                        ai_honor < 0
                    }
                    modifier = {
                        factor = 3
                        ai_rationality > 0
                    }
                    modifier = {
                        factor = 0
                        prisoner = yes
                    }
                    add_trait = wounded
                    #notify witch hunter
                }
                #Killed the killer
                10 = {
                    modifier = {
                        factor = 3
                        combat_rating > 30
                    }
                    modifier = {
                        factor = 2
                        combat_rating > 50
                    }
                    modifier = {
                        factor = 2
                        combat_rating > 70
                    }
                    modifier = {
                        factor = 0.5
                        prisoner = yes
                    }
                    modifier = {
                        factor = 0
                        is_incapable = yes
                    }
                    if = {
                        limit = {
                            has_character_flag = stalked_by_cultic_killer
                        }
                        random = {
                            chance = 60
                            corrupted_by_underground_cult_effect = yes
                        }
                    }
                    if = {
                        limit = {
                            NOT = {
                                trait = underground_cult_member
                            }
                        }
                        #notify witch hunter
                    }
                }
            }
            clr_character_flag = stalked_by_secret_killer
            clr_character_flag = stalked_by_cultic_killer
        }
    }

    #run away!
    option = {
        name = OK
        trigger = { ai = no }
        #write ai = no narrative
    }

    #fight!
    option = {
        name = OK
        trigger = { ai = no }
        #refer to witch hunter
    }

    #fail out for AI, just in case
    option = {
        name = OK
        trigger = { ai = yes }
    }
}
#victim of kidnapping attempt (possible brainwashing)
character_event = {
    id = wh_cults_and_hunters.281
    desc = EVTDESC_wh_cults_and_hunters_281
    picture = GFX_evt_whispers

    is_triggered_only = yes

    immediate = {
        if = {
            limit = {
                ai = yes
            }
            random_list = {
                #avoided contact
                30 = {
                    modifier = {
                        factor = 1.5
                        trait = craven
                    }
                    modifier = {
                        factor = 2
                        trait = paranoid
                    }
                    modifier = {
                        factor = 1.5
                        trait = shy
                    }
                    modifier = {
                        factor = 0.5
                        trait = gregarious
                    }
                    modifier = {
                        factor = 0.8
                        trait = socializer
                    }
                    modifier = {
                        factor = 0.5
                        has_law = witch_hunter_law_0
                    }
                    modifier = {
                        factor = 4
                        has_law = witch_hunter_law_3
                    }
                    #well-guarded
                    modifier = {
                        factor = 1.5
                        TIER = COUNT
                    }
                    modifier = {
                        factor = 2.5
                        tier = DUKE
                    }
                    modifier = {
                        factor = 4
                        tier = KING
                    }
                    modifier = {
                        factor = 6
                        tier = EMPEROR
                    }
                    #refer to Witch Hunter, if applicable
                }
                ##Outcomes for encountering the kidnappers
                #kidnapped
                20 = {
                    if = {
                        limit = {
                            has_character_flag = stalked_by_cultic_kidnappers
                        }
                        random = {
                            chance = 85
                            corrupted_by_underground_cult_effect = yes
                        }
                    }
                    #escape/ransom logic
                    random_list = {
                        #escape
                        20 = {
                            modifier = {
                                factor = 8
                                trait = underground_cult_member
                            }
                            add_trait = wounded
                        }
                        80 = {
                            #pay your own ransom
                            if = {
                                limit = {
                                    wealth = 10
                                }
                                wealth = -10
                            }
                            #good guy liege pays ransom - need ai=no to hvae their own answer before this
                            else_if = {
                                limit = {
                                    liege = {
                                        NOT = {
                                            is_foe = PREV
                                        }
                                        OR = {
                                            is_close_relative = PREV
                                            is_friend = PREV
                                            is_lover = PREV
                                            opinion = {
                                                who = PREV
                                                value > 50
                                            }
                                        }
                                    }
                                }
                                liege = {
                                    wealth = -10
                                }
                            }
                            else_if = {
                                limit = {
                                    has_character_flag = stalked_by_cultic_kidnappers
                                }
                                death = {
                                    death_reason = death_murder_unknown_butchered
                                }
                            }
                            else = {
                                add_maimed_trait_effect = yes
                            }
                        }
                    }
                }
                #Attacked and fled!
                15 = {
                    modifier = {
                        factor = 3
                        trait = craven
                    }
                    modifier = {
                        factor = 0.5
                        ai_honor < 0
                    }
                    modifier = {
                        factor = 3
                        ai_rationality > 0
                    }
                    modifier = {
                        factor = 0
                        prisoner = yes
                    }
                    add_trait = wounded
                    #notify witch hunter
                }
                #Fought them off!
                15 = {
                    modifier = {
                        factor = 3
                        combat_rating > 30
                    }
                    modifier = {
                        factor = 2
                        combat_rating > 50
                    }
                    modifier = {
                        factor = 2
                        combat_rating > 70
                    }
                    modifier = {
                        factor = 0.5
                        prisoner = yes
                    }
                    modifier = {
                        factor = 0
                        is_incapable = yes
                    }
                    if = {
                        limit = {
                            NOT = {
                                trait = underground_cult_member
                            }
                        }
                        #notify witch hunter
                    }
                }
            }
            clr_character_flag = stalked_by_criminal_kidnappers
            clr_character_flag = stalked_by_cultic_kidnappers
        }
    }

    #run away!
    option = {
        name = OK
        trigger = { ai = no }
        #write ai = no narrative
    }

    #fight!
    option = {
        name = OK
        trigger = { ai = no }
        #refer to witch hunter
    }

    #fail out for AI, just in case
    option = {
        name = OK
        trigger = { ai = yes }
    }
}

#encounter with disease victim
character_event = {
    id = wh_cults_and_hunters.291
    desc = EVTDESC_wh_cults_and_hunters_291
    picture = GFX_evt_whispers

    is_triggered_only = yes

    immediate = {
        if = {
            limit = {
                ai = yes
            }
            random_list = {
                #avoided contact
                30 = {
                    modifier = {
                        factor = 1.5
                        trait = craven
                    }
                    modifier = {
                        factor = 2
                        trait = paranoid
                    }
                    modifier = {
                        factor = 1.5
                        trait = shy
                    }
                    modifier = {
                        factor = 0.5
                        trait = gregarious
                    }
                    modifier = {
                        factor = 0.8
                        trait = socializer
                    }
                    modifier = {
                        factor = 0.5
                        has_law = witch_hunter_law_0
                    }
                    modifier = {
                        factor = 4
                        has_law = witch_hunter_law_3
                    }
                    modifier = {
                        factor = 0.5
                        is_in_society = cult_of_shallya
                    }
                    #well-guarded
                    modifier = {
                        factor = 1.5
                        TIER = COUNT
                    }
                    modifier = {
                        factor = 2.5
                        tier = DUKE
                    }
                    modifier = {
                        factor = 4
                        tier = KING
                    }
                    modifier = {
                        factor = 6
                        tier = EMPEROR
                    }
                    #refer to Witch Hunter, if applicable
                }
                ##Outcomes for being contacted
                #bleeding hearts
                60 = {
                    trigger = {
                        society_member_of = cult_of_shallya
                    }
                    if = {
                        limit = {
                            has_character_flag = accosted_by_contagious_cultist
                        }
                        random_list = {
                            10 = {
                                modifier = {
                                    factor = 3
                                    society_rank == 3
                                }
                                modifier = {
                                    factor = 4
                                    society_rank == 4
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = temperate
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = humble
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = charitable
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = kind
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = patient
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = diligent
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = zealous
                                }
                                modifier = {
                                    factor = 1.2
                                    diplomacy > 10
                                }
                                modifier = {
                                    factor = 1.5
                                    diplomacy > 15
                                }
                                change_society_currency = 100
                                event_target:cult_leader = {
                                    subtract_variable = {
                                        which = cultic_influence
                                        value = 10
                                    }
                                }
                                #no sickness test, fully protected by Shallya's mercy
                            }
                            90 = {
                                modifier = {
                                    factor = 1.2
                                    diplomacy < 5
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = wroth
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = proud
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = envious
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = slothful
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = greedy
                                }
                                modifier = {
                                    factor = 1.1
                                    trait = gluttonous
                                }
                                modifier = {
                                    factor = 1.2
                                    trait = cynical
                                }
                                #you tried
                                change_society_currency = 10
                                random = {
                                    chance = 70
                                    add_symptom_effect = yes
                                }
                            }
                        }
                    }
                    else = {
                        change_society_currency = 50
                        random = {
                            chance = 10
                            add_symptom_effect = yes
                        }
                    }
                }
                #get sick
                30 = {
                    trigger = {
                        NOT = {
                            society_member_of = cult_of_shallya
                        }
                    }
                    modifier = {
                        factor = 1.5
                        is_weak_trigger = yes
                    }
                    modifier = {
                        factor = 2
                        has_character_flag = accosted_by_contagious_cultist
                    }
                    add_symptom_effect = yes
                    #might be corrupted due to illness
                    if = {
                        limit = {
                            has_character_flag = accosted_by_contagious_cultist
                        }
                        random = {
                            chance = 60
                            mult_modifier = {
                                factor = 1.5
                                trait = craven
                            }
                            corrupted_by_underground_cult_effect = yes
                        }
                    }
                }
                #don't get sick
                30 = {
                    trigger = {
                        NOT = {
                            society_member_of = cult_of_shallya
                        }
                    }
                    modifier = {
                        factor = 1.5
                        is_strong_trigger = yes
                    }
                    if = {
                        limit = {
                            has_character_flag = accosted_by_contagious_cultist
                        }
                        #corrupted by fear alone
                        random = {
                            chance = 5
                            mult_modifier = {
                                factor = 3
                                trait = craven
                            }
                            corrupted_by_underground_cult_effect = yes
                        }
                    }
                }
            }
            clr_character_flag = accosted_by_contagious_peasant
            clr_character_flag = accosted_by_contagious_cultist
        }
    }

    #run away!
    option = {
        name = OK
        trigger = { ai = no }
        #write ai = no narrative
    }

    #fight!
    option = {
        name = OK
        trigger = { ai = no }
        #refer to witch hunter
    }

    #fail out for AI, just in case
    option = {
        name = OK
        trigger = { ai = yes }
    }
}

#chaos cult instigate revolt
province_event = {
    id = wh_cults_and_hunters.401
    desc = EVTDESC_wh_cults_and_hunters_401
    picture = GFX_evt_chaos_attack
    border = GFX_event_normal_frame_war

    is_triggered_only = yes

    immediate = {
        religion = event_target:active_cult_leader
        create_character = {
            random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 32
            attributes = {
                martial = 6
            }
            trait = underground_cult_member
            trait = tough_soldier
        }
        new_character = {
            set_character_flag = religious_revolter
            set_character_flag = underground_cult_member
            save_persistent_event_target = {
                name = underground_cult_allegiance
                scope = event_target:cult_identity
            }
            if = {
                limit = {
                    NOR = {
                        culture_group = albion_group
                        culture_group = bretonnian_group
                        culture_group = estalian_group
                        culture_group = halfling_group
                        culture_group = hung_group
                        culture_group = imperial_group
                        culture_group = kurgan_group
                        culture_group = sartosan_group
                        culture_group = tilean_group
                    }
                }
                culture = event_target:active_cult_leader
            }
            create_title = {
                tier = DUKE
                landless = yes
                temporary = yes
                rebel = yes
                culture = ROOT
                name = "CHAOS_CULTIST_REVOLT"
                holder = THIS
            }
            wealth = 100


            trigger_switch = {
                on_trigger = has_global_flag
                doom_very_low = {
                    while = {
                        count = 1
                        wealth = 25
                        spawn_heretic_army_effect = yes
                    }
                }
                doom_low = {
                    while = {
                        count = 1
                        wealth = 25
                        spawn_heretic_army_effect = yes
                    }
                }
                doom_medium = {
                    while = {
                        count = 2
                        wealth = 25
                        spawn_heretic_army_effect = yes
                    }
                }
                doom_high = {
                    while = {
                        count = 2
                        wealth = 25
                        spawn_heretic_army_effect = yes
                    }
                }
                doom_very_high = {
                    while = {
                        count = 3
                        wealth = 25
                        spawn_heretic_army_effect = yes
                    }
                }
            }

            # DoW on the province top liege
			ROOT = {
				owner = {
					top_liege = {
						reverse_war = {
							target = PREVPREVPREV
							casus_belli = religious_revolt
							thirdparty_title = ROOT # The county...
							tier = DUKE # ... but really the de jure duchy
						}
						reverse_opinion = {
							who = PREVPREVPREV
							modifier = opinion_evil_tyrant
						}
					}
				}
			}
        }

        owner = {
            any_liege = { # Inform the lieges
                #character_event = {
                #    id =
                #}
            }
        }
    }

    option = {
        name = EVTOPTA_wh_cults_and_hunters_401
    }
}

### Witch Hunter Activity ###

##Recruiting Special Agents
#Initial menu
character_event = {
    id = wh_cults_and_hunters.501
    desc = EVTDESC_wh_cults_and_hunters_501
    picture = GFX_evt_council

    is_triggered_only = yes

    immediate = {
        #all ai logic here
        if = {
            limit = {
                ai = yes
            }
            random = {
                chance = 70
                mult_modifier = {
                    factor = 1.3
                    ai_zeal >= 50
                }
                mult_modifier = {
                    factor = 0.7
                    ai_zeal <= -50
                }
                #decide hunter type
                random_list = {
                    20 = {
                        modifier = {
                            factor = 3
                            ai_rationality >= 50
                        }
                        create_adventurer_hunter_effect = yes
                    }
                    25 = {
                        trigger = {
                            religion = classical_pantheon
                        }
                        modifier = {
                            factor = 1.5
                            ai_zeal >= 50
                        }
                        create_myrmidian_inquisitor_witch_hunter_effect = yes
                    }
                    25 = {
                        trigger = {
                            religion = grail
                        }
                        modifier = {
                            factor = 1.5
                            ai_zeal >= 50
                        }
                        create_bretonnian_knight_witch_hunter_effect = yes
                    }
                    25 = {
                        trigger = {
                            religion = imperial_pantheon
                        }
                        modifier = {
                            factor = 1.5
                            ai_zeal >= 50
                        }
                        create_sigmarite_templar_witch_hunter_effect = yes
                    }
                    25 = {
                        trigger = {
                            religion = kislev_gods
                        }
                        modifier = {
                            factor = 1.5
                            ai_zeal >= 50
                        }
                        create_ice_witch_witch_hunter_effect = yes
                    }
                    15 = {
                        create_order_of_the_shroud_witch_hunter_effect = yes
                    }
                    15 = {
                        create_order_of_the_sword_and_scale_witch_hunter_effect = yes
                    }
                    10 = {
                        modifier = {
                            factor = 2
                            is_doom_high = yes
                        }
                        modifier = {
                            factor = 3
                            is_doom_very_high = yes
                        }
                        create_temple_of_solkan_witch_hunter_effect = yes
                    }
                    5 = {
                        trigger = {
                            OR = {
                                is_doom_high = yes
                                is_doom_very_high = yes
                            }
                        }
                        modifier = {
                            factor = 2
                            is_doom_very_high = yes
                        }
                        create_emissary_of_order_witch_hunter_effect = yes
                    }
                }
                event_target:hunter_candidate = {
                    give_minor_title = title_court_witchhunter
                }
            }
        }
    }

    #skilled adventurer
    option = {
        name = EVTOPTA_wh_cults_and_hunters_501
        trigger = { ai = no }
        scaled_wealth = -0.25
        narrative_event = {
            id = wh_cults_and_hunters.503
            days = 14
            random = 14
            tooltip = witch_hunter_arrives_shortly_tt
        }
    }

    ##religious group agents
    #Classical Pantheon - Myrmidian Inquisitor
    option = {
        tooltip_info_custom = available_because_classical_pantheon
        name = EVTOPTB_wh_cults_and_hunters_501
        trigger = {
            ai = no
            religion = classical_pantheon
        }
        if = {
            limit = {
                OR = {
                    has_law = witch_hunter_law_2
                    has_law = witch_hunter_law_3
                }
            }
            piety = 50
        }
        scaled_wealth = -0.25
        narrative_event = {
            id = wh_cults_and_hunters.504
            days = 14
            random = 14
            tooltip = witch_hunter_arrives_shortly_tt
        }
    }
    #Grail - Knight Errant
    option = {
        tooltip_info_custom = available_because_grail
        name = EVTOPTC_wh_cults_and_hunters_501
        trigger = {
            ai = no
            religion = grail
        }
        if = {
            limit = {
                OR = {
                    has_law = witch_hunter_law_2
                    has_law = witch_hunter_law_3
                }
            }
            piety = 50
        }
        scaled_wealth = -0.25
        narrative_event = {
            id = wh_cults_and_hunters.505
            days = 14
            random = 14
            tooltip = witch_hunter_arrives_shortly_tt
        }
    }
    #Imperial Pantheon - Sigmarite Templar
    option = {
        tooltip_info_custom = available_because_imperial_pantheon
        name = EVTOPTD_wh_cults_and_hunters_501
        trigger = {
            ai = no
            religion = imperial_pantheon
        }
        if = {
            limit = {
                OR = {
                    has_law = witch_hunter_law_2
                    has_law = witch_hunter_law_3
                }
            }
            piety = 50
        }
        scaled_wealth = -0.25
        narrative_event = {
            id = wh_cults_and_hunters.506
            days = 14
            random = 14
            tooltip = witch_hunter_arrives_shortly_tt
        }
    }
    #Kislev Gods - Ice Witch
    option = {
        tooltip_info_custom = available_because_kislev_gods
        name = EVTOPTE_wh_cults_and_hunters_501
        trigger = {
            ai = no
            religion = kislev_gods
        }
        if = {
            limit = {
                OR = {
                    has_law = witch_hunter_law_2
                    has_law = witch_hunter_law_3
                }
            }
            piety = 50
        }
        scaled_wealth = -0.25
        narrative_event = {
            id = wh_cults_and_hunters.507
            days = 14
            random = 14
            tooltip = witch_hunter_arrives_shortly_tt
        }
    }

    #Agent of an ancient order
    option = {
        name = EVTOPTF_wh_cults_and_hunters_501
        trigger = { ai = no }
        #go to submenu
        character_event = {
            id = wh_cults_and_hunters.502
        }
    }

    #pass
    option = {
        name = ILL_WAIT_A_BIT
		trigger = { ai = no }
		clr_character_flag = employing_witch_hunter
    }

    #AI fall out of event. Not sure if they need this but w/ev
    option = {
        name = OK
        trigger = { ai = yes }
    }
}

character_event = {
    id = wh_cults_and_hunters.502
    desc = EVTDESC_wh_cults_and_hunters_502
    picture = GFX_evt_council

    is_triggered_only = yes

    #Order of the Shroud (Morr)
    option = {
        name = EVTOPTA_wh_cults_and_hunters_502
        scaled_wealth = -0.25
        if = {
            limit = {
                NOT = {
                    trait = patron_morr
                }
            }
            prestige = -100
            piety = -100
        }
        narrative_event = {
            id = wh_cults_and_hunters.508
            days = 14
            random = 14
            tooltip = witch_hunter_arrives_shortly_tt
        }
    }
    #Order of the Scale and Sword (Verena)
    option = {
        name = EVTOPTB_wh_cults_and_hunters_502
        scaled_wealth = -0.25
        if = {
            limit = {
                NOT = {
                    trait = patron_verena
                }
            }
            prestige = -100
            piety = -100
        }
        narrative_event = {
            id = wh_cults_and_hunters.509
            days = 14
            random = 14
            tooltip = witch_hunter_arrives_shortly_tt
        }
    }
    #Temple of Solkan (Law God)
    option = {
        name = EVTOPTC_wh_cults_and_hunters_502
        scaled_wealth = -0.25
        if = {
            limit = {
                NOT = {
                    trait = patron_soll
                }
            }
            prestige = -250
            piety = -250
        }
        custom_tooltip = {
            text = witch_hunter_arrives_shortly_tt
            random_list = {
                80 = {
                    narrative_event = {
                        id = wh_cults_and_hunters.510
                        days = 14
                        random = 14
                    }
                }
                #if things are really bad in the Old World, the Law God may send one of its champions
                10 = {
                    trigger = {
                        OR = {
                            is_doom_high = yes
                            is_doom_very_high = yes
                        }
                    }
                    modifier = {
                        factor = 2
                        is_doom_very_high = yes
                    }
                    narrative_event = {
                        id = wh_cults_and_hunters.511
                        days = 14
                        random = 14
                    }
                }
            }
        }
    }
    #Return to base menu
    option = {
        name = EVTOPTD_wh_cults_and_hunters_502
        custom_tooltip = {
            text = return_to_previous_menu_tt
            character_event = { id = wh_cults_and_hunters.501 }
        }
    }
}

#Adventurer
narrative_event = {
    id = wh_cults_and_hunters.503
    title = EVTTITLE_wh_cults_and_hunters_503
    desc = {
        trigger = {
            event_target:hunter_candidate = {
                has_character_flag = army_veteran_witch_hunter
            }
        }
        text = EVTDESCA_wh_cults_and_hunters_503
    }
    desc = {
        trigger = {
            event_target:hunter_candidate = {
                has_character_flag = bold_scholar_witch_hunter
            }
        }
        text = EVTDESCB_wh_cults_and_hunters_503
    }
    desc = {
        trigger = {
            event_target:hunter_candidate = {
                has_character_flag = crafty_spy_witch_hunter
            }
        }
        text = EVTDESCC_wh_cults_and_hunters_503
    }
    picture = GFX_evt_witch_hunters

    is_triggered_only = yes

    immediate = {
        create_adventurer_hunter_effect = yes
    }

    option = {
        name = EXCELLENT
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
    }
    option = {
        name = EVTOPT_wh_cults_and_hunters_unwanted_hunter
        event_target:hunter_candidate = {
            death = { death_reason = death_missing }
        }
        clr_character_flag = employing_witch_hunter
    }
}

#Myrmidian Inquisitor
narrative_event = {
    id = wh_cults_and_hunters.504
    title = EVTTITLE_wh_cults_and_hunters_504
    desc = EVTDESC_wh_cults_and_hunters_504
    picture = GFX_evt_witch_hunters

    is_triggered_only = yes

    immediate = {
        create_myrmidian_inquisitor_witch_hunter_effect = yes
    }

    option = {
        name = EXCELLENT
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
    }
    option = {
        name = EVTOPT_wh_cults_and_hunters_unwanted_hunter
        event_target:hunter_candidate = {
            death = { death_reason = death_missing }
        }
        clr_character_flag = employing_witch_hunter
    }
}

#Bretonnian Knight
narrative_event = {
    id = wh_cults_and_hunters.505
    title = EVTTITLE_wh_cults_and_hunters_505
    desc = EVTDESC_wh_cults_and_hunters_505
    picture = GFX_evt_bretonnian_knight

    is_triggered_only = yes

    immediate = {
        create_bretonnian_knight_witch_hunter_effect = yes
    }

    option = {
        name = EXCELLENT
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
    }
    option = {
        name = EVTOPT_wh_cults_and_hunters_unwanted_hunter
        event_target:hunter_candidate = {
            death = { death_reason = death_missing }
        }
        clr_character_flag = employing_witch_hunter
    }
}

#Sigmarite Templar
narrative_event = {
    id = wh_cults_and_hunters.506
    title = EVTTITLE_wh_cults_and_hunters_506
    desc = EVTDESC_wh_cults_and_hunters_506
    picture = GFX_evt_witch_hunters

    is_triggered_only = yes

    immediate = {
        create_sigmarite_templar_witch_hunter_effect = yes
    }

    option = {
        name = EXCELLENT
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
    }
    option = {
        name = EVTOPT_wh_cults_and_hunters_unwanted_hunter
        event_target:hunter_candidate = {
            death = { death_reason = death_missing }
        }
        clr_character_flag = employing_witch_hunter
    }
}

#Ice Witch
narrative_event = {
    id = wh_cults_and_hunters.507
    title = EVTTITLE_wh_cults_and_hunters_507
    desc = EVTDESC_wh_cults_and_hunters_507
    picture = GFX_evt_kislev_ice_witch

    is_triggered_only = yes

    immediate = {
        create_ice_witch_witch_hunter_effect = yes
    }

    option = {
        name = EXCELLENT
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
    }
    option = {
        name = EVTOPT_wh_cults_and_hunters_unwanted_hunter
        event_target:hunter_candidate = {
            death = { death_reason = death_missing }
        }
        clr_character_flag = employing_witch_hunter
    }
}

#Order of the Shroud
narrative_event = {
    id = wh_cults_and_hunters.508
    title = EVTTITLE_wh_cults_and_hunters_508
    desc = EVTDESC_wh_cults_and_hunters_508
    picture = GFX_evt_morr_priests

    is_triggered_only = yes

    immediate = {
        create_order_of_the_shroud_witch_hunter_effect = yes
    }

    option = {
        name = EXCELLENT
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
    }
    option = {
        name = EVTOPT_wh_cults_and_hunters_unwanted_hunter
        event_target:hunter_candidate = {
            death = { death_reason = death_missing }
        }
        clr_character_flag = employing_witch_hunter
    }
}

#Order of the Sword and Scale
narrative_event = {
    id = wh_cults_and_hunters.509
    title = EVTTITLE_wh_cults_and_hunters_509
    desc = EVTDESC_wh_cults_and_hunters_509
    picture = GFX_evt_morr_priests

    is_triggered_only = yes

    immediate = {
        create_order_of_the_sword_and_scale_witch_hunter_effect = yes
    }

    option = {
        name = EXCELLENT
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
    }
    option = {
        name = EVTOPT_wh_cults_and_hunters_unwanted_hunter
        event_target:hunter_candidate = {
            death = { death_reason = death_missing }
        }
        clr_character_flag = employing_witch_hunter
    }
}

#Temple of Solkan
narrative_event = {
    id = wh_cults_and_hunters.510
    title = EVTTITLE_wh_cults_and_hunters_510
    desc = EVTDESC_wh_cults_and_hunters_510
    picture = GFX_evt_witch_hunters

    is_triggered_only = yes

    immediate = {
        create_temple_of_solkan_witch_hunter_effect = yes
    }

    option = {
        name = EXCELLENT
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
    }
    option = {
        name = EVTOPT_wh_cults_and_hunters_unwanted_hunter
        event_target:hunter_candidate = {
            death = { death_reason = death_missing }
        }
        clr_character_flag = employing_witch_hunter
    }
}

#emissary of Order
narrative_event = {
    id = wh_cults_and_hunters.511
    title = EVTTITLE_wh_cults_and_hunters_511
    desc = EVTDESC_wh_cults_and_hunters_511
    picture = GFX_evt_mage_lore_light

    is_triggered_only = yes

    immediate = {
        create_emissary_of_order_witch_hunter_effect = yes
    }

    option = {
        name = EVTOPTA_wh_cults_and_hunters_511
        tooltip_info_custom = required_because_arrow_of_law
        event_target:hunter_candidate = {
            give_minor_title = title_court_witchhunter
        }
        #should probably have some extra narrative events but that could wait for Land of the Law God
    }
}

#Witch Hunter tactical pulse (on_yearly_pulse)
character_event = {
    id = wh_cults_and_hunters.601
    hide_window = yes
    is_triggered_only = yes

    only_playable = yes

    trigger = {
        true_religion_group = old_world_group
        NOT = { religion = old_faith }
    }

    immediate = {
        generate_new_false_clues_effect = yes
        ## Witch Hunt Logic ##
        if = {
            limit = {
                any_courtier_or_vassal = {
                    trait = on_witch_hunt
                }
            }
            #possible interaction with witch hunter to secure additional backing
        }
        #specialist hunter
        else_if = {
            limit = {
                any_courtier_or_vassal = {
                    has_minor_title = title_court_witchhunter
                }
            }
            random_courtier_or_vassal = {
                limit = {
                    has_minor_title = title_court_witchhunter
                }
                save_event_target_as = court_witchhunter
            }
            witch_hunter_looks_for_deviant_courtiers_effect = yes
        }
        #traditional law
        else_if = {
            limit = {
                has_law = witch_hunter_law_0
            }
            any_courtier_or_vassal = {
                limit = {
                    has_job_title = job_spiritual
                }
                save_event_target_as = court_witchhunter
            }
            witch_hunter_looks_for_deviant_courtiers_effect = yes
        }
        #ai rulers without witch hunters typically hire one
        else_if = {
            limit = {
                ai = yes
            }
            random = {
                chance = 65
                mult_modifier = {
                    factor = 1.4
                    has_law = witch_hunter_law_3
                }
                character_event = {
                    id = wh_cults_and_hunters.501
                }
            }
        }
        #no need for else clause here - ai=no doesn't need a yearly reminder
    }
}

#Start witch hunt
character_event = {
    id = wh_cults_and_hunters.610
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        event_target:court_witchhunter = {
            add_trait = on_witch_hunt
        }
        ###determine how long the hunter will be busy###
        #Inquisitors are generally efficient
        if = {
            limit = {
                event_target:court_witchhunter = {
                    OR = {
                        has_character_flag = sigmarite_templar_witch_hunter
                        has_character_flag = myrmidian_inquisitor_witch_hunter
                        has_character_flag = ice_witch_witch_hunter
                    }
                }
            }
            character_event = {
                id = wh_cults_and_hunters.611
                days = 210
                random = 90
            }
        }
        ##specialists are very effective in their specific domain##
        #adventurers are best when there's no real cult activity
        else_if = {
            limit = {
                event_target:clue_county = {
                    NOT = {
                        has_province_flag = cultic_activity
                    }
                }
                event_target:court_witchhunter = {
                    OR = {
                        has_character_flag = army_veteran_witch_hunter
                        has_character_flag = bold_scholar_witch_hunter
                        has_character_flag = crafty_spy_witch_hunter
                    }
                }
            }
            character_event = {
                id = wh_cults_and_hunters.611
                days = 152
                random = 60
            }
        }
        #solkanites burn chaos
        else_if = {
            limit = {
                event_target:court_witchhunter = {
                    has_character_flag = temple_of_solkan_witch_hunter
                }
                event_target:active_cult_leader = {
                    true_religion_group = chaos_gods_group
                }
            }
            character_event = {
                id = wh_cults_and_hunters.611
                days = 152
                random = 60
            }
        }
        #order of the shroud burns necromantics
        else_if = {
            limit = {
                event_target:court_witchhunter = {
                    has_character_flag = order_of_the_shroud_witch_hunter
                }
                event_target:active_cult_leader = {
                    true_religion_group = necromantic_group
                }
            }
            character_event = {
                id = wh_cults_and_hunters.611
                days = 152
                random = 60
            }
        }
        #the emissary absolutely fries Chaos
        else_if = {
            limit = {
                event_target:court_witchhunter = {
                    has_character_flag = emissary_of_order_witch_hunter
                }
                event_target:active_cult_leader = {
                    true_religion_group = chaos_gods_group
                }
            }
            character_event = {
                id = wh_cults_and_hunters.611
                days = 60
                random = 60
            }
        }
        ##now that we've picked out hunter flags with special effects, trait only picks up hunters outside their specialty##
        else_if = {
            limit = {
                event_target:court_witchhunter = {
                    trait = witch_hunter
                }
            }
            character_event = {
                id = wh_cults_and_hunters.611
                days = 275
                random = 180
            }
        }
        #the else case usually means that the court priest is doing the witch hunting
        else = {
            character_event = {
                id = wh_cults_and_hunters.611
                days = 550
                random = 360
            }
        }
    }
}

#Witch Hunter finishes Witch Hunt
character_event = {
    id = wh_cults_and_hunters.611
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        event_target:court_witchhunter = {
            remove_trait = on_witch_hunt
            #check for property damage
            trigger_switch = {
                on_trigger = has_character_flag
                emissary_of_order_witch_hunter = {
                    event_target:clue_county = {
                        add_province_modifier = {
                            name = touch_of_the_law_god
                            duration = 1820
                        }
                    }
                }
                temple_of_solkan_witch_hunter = {
                    event_target:clue_county = {
                        add_province_modifier = {
                            name = terrorized_by_witch_hunter
                            duration = 1820
                        }
                    }
                }
                order_of_the_sword_and_scale_witch_hunter = {
                    event_target:clue_county = {
                        add_province_modifier = {
                            name = verenan_order
                            duration = 1820
                        }
                    }
                }
                fallback = {
                    event_target:clue_county = {
                        add_province_modifier = {
                            name = terrorized_by_witch_hunter
                            duration = 1095
                        }
                    }
                }
            }
        }
        #apply damage to the cult, if applicable
        if = {
            limit = {
                event_target:clue_county = {
                    has_province_flag = cultic_activity
                }
            }
            event_target:active_cult_leader = {
                #base damage from flag/trait - honor player intuitions about hunters
                if = {
                    limit = {
                        event_target:court_witchhunter = {
                            OR = {
                                has_character_flag = sigmarite_templar_witch_hunter
                                has_character_flag = myrmidian_inquisitor_witch_hunter
                                has_character_flag = ice_witch_witch_hunter
                            }
                        }
                    }
                    subtract_variable = {
                        which = cultic_influence
                        value = -30
                    }
                    wealth = -60
                }
                else_if = {
                    limit = {
                        event_target:court_witchhunter = {
                            has_character_flag = temple_of_solkan_witch_hunter
                        }
                        religion_group = chaos_gods_group
                    }
                    subtract_variable = {
                        which = cultic_influence
                        value = -35
                    }
                    wealth = -70
                }
                else_if = {
                    limit = {
                        event_target:court_witchhunter = {
                            has_character_flag = order_of_the_shroud_witch_hunter
                        }
                        religion_group = necromantic_group
                    }
                    subtract_variable = {
                        which = cultic_influence
                        value = -35
                    }
                    wealth = -70
                }
                else_if = {
                    limit = {
                        event_target:court_witchhunter = {
                            has_character_flag = emissary_of_order_witch_hunter
                        }
                        religion_group = chaos_gods_group
                    }
                    subtract_variable = {
                        which = cultic_influence
                        value = -50
                    }
                    wealth = -100
                }
                #now that we've picked out hunter flags with special effects, we can check for the trait only
                else_if = {
                    limit = {
                        event_target:court_witchhunter = {
                            trait = witch_hunter
                        }
                    }
                    subtract_variable = {
                        which = cultic_influence
                        value = -25
                    }
                    wealth = -50
                }
                else = {
                    subtract_variable = {
                        which = cultic_influence
                        value = -20
                    }
                    wealth = -40
                }
                #additional damage from high intrigue hunters - honor player intuitions about competent hunters
                if = {
                    limit = {
                        event_target:court_witchhunter = {
                            intrigue = 20
                        }
                    }
                    subtract_variable = {
                        which = cultic_influence
                        value = -15
                    }
                    wealth = -30
                }
                else_if = {
                    limit = {
                        event_target:court_witchhunter = {
                            intrigue = 15
                        }
                    }
                    subtract_variable = {
                        which = cultic_influence
                        value = -10
                    }
                    wealth = -20
                }
                else_if = {
                    limit = {
                        event_target:court_witchhunter = {
                            intrigue = 10
                        }
                    }
                    subtract_variable = {
                        which = cultic_influence
                        value = -5
                    }
                    wealth = -10
                }
            }
            event_target:cult_identity = {
                clr_title_flag = cult_is_influencing_@event_target:clue_county
            }
        }
        #clean up
        event_target:clue_county = {
            clr_province_flag = cultic_activity
            remove_province_modifier = clue_extortion_cultic
            remove_province_modifier = clue_extortion_normal
            remove_province_modifier = clue_rituals_cultic
            remove_province_modifier = clue_rituals_normal
            remove_province_modifier = clue_abductions_cultic
            remove_province_modifier = clue_abductions_normal
            remove_province_modifier = clue_murders_cultic
            remove_province_modifier = clue_murders_normal
            remove_province_modifier = clue_contagion_cultic
            remove_province_modifier = clue_contagion_normal
            remove_province_modifier = clue_celebration_cultic
            remove_province_modifier = clue_celebration_normal
        }
    }
}

#Captured "cultist" events
character_event = {
    id = wh_cults_and_hunters.701
    desc = EVTDESC_wh_cults_and_hunters_701
    picture = GFX_evt_into_the_dungeon

    hide_window = yes
    is_triggered_only = yes

    immediate = {
        random_list = {
            #stress
            50 = {
                modifier = {
                    factor = 0.5
                    event_target:court_witchhunter = {
                        OR = {
                            trait = cruel
                            trait = impaler
                        }
                    }
                }
                prisoner_humiliation_effect = yes
                character_event = {
                    id = wh_cults_and_hunters.701
                    days = 10
                }
            }
            #physical damage
            20 = {
                modifier = {
                    factor = 0.5
                    event_target:court_witchhunter = {
                        has_character_flag = order_of_the_sword_and_scale_witch_hunter
                    }
                }
                modifier = {
                    factor = 2
                    event_target:court_witchhunter = {
                        OR = {
                            trait = cruel
                            trait = impaler
                        }
                    }
                }
                prisoner_mutilate_effect = yes
                random = {
                    chance = 25
                    add_maimed_trait_effect = yes
                }
                character_event = {
                    id = wh_cults_and_hunters.701
                    days = 10
                }
            }
            #psychological damage
            10 = {
                modifier = {
                    factor = 1.5
                    event_target:court_witchhunter = {
                        OR = {
                            trait = cruel
                            trait = impaler
                        }
                    }
                }
                prisoner_torture_effect = yes
                character_event = {
                    id = wh_cults_and_hunters.701
                    days = 10
                }
            }
            #cultist breaks
            20 = {
                trigger = {
                    trait = underground_cult_member
                }
                modifier = {
                    factor = 0.2
                    event_target:court_witchhunter = {
                        NOT = { trait = witch_hunter }
                    }
                }
                modifier = {
                    factor = 1.1
                    health < 4
                }
                modifier = {
                    factor = 1.1
                    health < 3
                }
                modifier = {
                    factor = 1.2
                    health < 2
                }
                modifier = {
                    factor = 1.5
                    trait = stressed
                }
                modifier = {
                    factor = 2
                    trait = craven
                }
                modifier = {
                    factor = 0.2
                    trait = brave
                }
                modifier = {
                    factor = 0.5
                    trait = stubborn
                }
                persistent_event_target:underground_cult_allegiance = {
                    holder_scope = {
                        subtract_variable = {
                            which = cultic_influence
                            value = 100
                        }
                    }
                }
                death = {
                    death_reason = death_execution_burning
                    killer = event_target:witch_hunter_employer
                }
            }
        }
    }
}
